# 网络协议

## TCP/IP参考模型

```markdown
TCP/IP  是传输控制协议 / 网络互联协议的简称
早期的TCP / IP 模型是一个四层结构 从下向上一次是 网络接口层 互联网层 传输层 和应用层
后来在使用过程中 借鉴了 OSI七层参考模型 降网络接口层 划分为了 物理层 和数据链路层 形成五层结构

物理层 -> 数据链路层 -> 网络层 -> 传输层 -> 会话层 -> 表示层 -> 应用层
```

## 协议的概念和作用

```markdown
为了计算机能够通信 计算机需要定义通信规则 这些规则就是协议
规则是多种的 协议也有多种
协议就是数据封装格式 + 传输
```

### 网络接口层

```markdown
网络接口层是 TCP / IP 负责接收从上一层交来的数据包 并将 数据包 通过底层的物理网络发送出去
主要分为 物理层 和 网路链路层
```

#### 物理层

```markdown
1. 计算机 在传递数据的时候 传递的都是 0 1的数字 而物理层关心的是 用什么信号来比表示0 1 是否可以双向通信 最初的链接如何建立 以及 完成链接如何终止 物理层是为数据传输提供可靠环境
2. 尽可能的屏蔽掉物理设备和传输媒介 是数据链路层不考虑这些差异 只考虑本层的协议和服务
3. 为用户提供在一条物理传输媒体上提供传送和接收比特流的能力
```

```markdown
1. 这个时候 就设计到 物理层用什么样的物理信号来表示 0 1
2. 有两种编码 形式 非归零编码 以高电平表示 0  低电平 表示 1 这种区分不出来频率也就是时钟信号 收发端同步困难
3. 曼彻斯特编码 内含时钟信号 编译复杂 
```

#### 数据链路层

```markdown
1. 在物理层提供的服务基础上 向网络层提供服务 最基本的服务是源自网络层来的数据可靠地传输到相邻节点的目标网络层 
2. 如何将数据组合成数据块 在数据链路层称数据块为帧 trame 帧是数据链路层的传送单位
3. 建立两个网络实体之间提供数据链路通路的建立 维持和释放的管理
4. 控制帧在物理信道上的传输 包括处理传输差错 如何调节发送速率以使与接受方式相匹配
```

#### 以太网

```markdown
1. 一种局域网技术
2. 所有设备的网线都链接在一个总线上
3. 总线网络采用 载波监听多路访问 / 冲突检测协议 作为控制策略
4. 载波监听多路访问 先听后讲 信道空闲则发送 信道忙则等待 边听边讲 发送信号时不断检测信道是否碰撞 碰撞即停 避免重传 二进制指数退避重传 多次碰撞 放弃发送 最多16次
```

#### MAC地址

```markdown
1. 在通信过程中是用内置网卡内的地址来标识计算机身份的
2. 每个网卡都有一个全球的地址来标识自己 不会重复
3. MAC地址48位的二进制组成 同城分为6段 用16进制来表示
```

#### ARP协议

```markdown
1. 根据 ip 地址 获取 MAC 地址的协议
2. 主机发送信息时 将包含目标IP地址的APR请求广播到网络上的所有主机 并接收返回消息 以确定目标的物理地址 收到返回消息后将该IP地址和物理地址存入本机 ARP中并保留一定时间 下次请求时直接查询APR缓存
```

## 互联网层(网络层)

```markdown
1. 位于传输层 和 网络接口层之间 用于把数据从源主机经过若干中间节点传送到目标主机 并向传输层提供最基础的数据传输服务 他要提供路由和选址工作
```

#### 路由

```js
1. 在能够选择的多条道路之间选择一条最短的路径作为网络传输 就是路由的工作
2. 我们网络可能是由多个路由器组成的 那么 两台设备之间最近的网络链接线路寻找 就是路由的工作
```

#### IP地址

```js
  1. 在网络中 每台计算机都有一个唯一的地址 方便别人找到它 这个地址称为IP地址
```

```    
版本(4)    首部长度(4)    优先级与服务类型(8)           总长度(16)
        标识符(16)                            标志(3)    段偏移量(13)
TTL(8)      协议号(8)                                首部校验和(16)
          源      地           址          	(32)
         目标      地           址          	(32)
          可                     选              项 
               数                            据
```

#### IP地址格式

```markdown
IP 地址是一个网络编码 用来确定网络中的一个节点
IP 地址 是由 32位 二进制组成
IP 地址组成 由网络部分 和 主机部分 
```

#### IP地址的分类

```markdown
IP 地址的网络部分 是由 internet地址分配机构来统一分配的  这样可以保证IP的唯一性 
IP 地址 分为 A类 B类 和C类 每个类别地址在同一个 局域网内容纳的 主机 数量不一样 我们常用的就是C类地址  A 到 B 到 C 地址是越来越多   但是 可以容纳的主机是从多到少的
```

#### 子网掩码

```markdown
1. 子网掩码 又叫 自网络遮罩 一种用来指明 一个ip地址的那些位标识的是主机所在的子网 以及那些位标识的是主机位的掩码
2. 子网掩码不能单独存在 它必须结合IP地址一起使用
3. 子网掩码只有一个作用 就是将某个IP地址划分成网络地址和主机地址两部分 子网掩码 也是32个二进制位 对应IP的网络部分用 1 表示
```

```markdown
我们可以理解为 一个单位的网络入口 只有一个 ip地址 我们在通过子网掩码 去把这个ip地址区分为 子网 只有 每个ip 地址 与 运算 子网掩码 之后 的值相等 才能通信
```

## 传输层

```markdown
1. 位于应用层 和 网络接口层之间
2. 是面向链接的 可靠的 进程 到进程通信的协议
3. TCP 提供全双工服务 就是数据可在同一时间双向传播
```

### 传输层作用

```markdown
1. 提供了 端到端 的链接
```

### 协议的分类

```markdown
1. TCP 传输控制协议 可靠的 面向链接的协议 传输效率低
2. TCP 将数据进行分段打包传输 对每个数据包编号控制顺序 运输中丢失 重发和丢弃处理 流量控制避免拥塞
2. UDP 用户数据据报协议 不可靠 无链接服务 传输效率高
```

### 三次握手和四次挥手

```markdown
1. TCP 是面向链接的协议 它在源点和终点建立虚拟链接 而不是物理链接 
2. 在数据通信之前 发送端 与 接收端首先要建立链接 等数据发送结束之后 双方在断开链接 
3. TCP 链接的每一方都是由IP地址和一个端口组成
4. 三次握手 客户端跟服务端说你在么 服务端回 我在 客户端在回 好的 那我要准备给你发送数据了
5. 四次挥手 当数据发送完毕之后 客户端跟服务端说 我要关闭了 服务端回好的 然后服务端给客户端发送 我也要关闭了 然后客户端回好的 
```

## DNS服务器

```markdown
1. DNS 是一个 域名系统
1. IP地址不易记忆 所以我们用域名的形式 需要DNS解析成IP地址
```

## DHCP

```markdown
1. 动态主机配置服务
2. 也就是动态配置IP地址的
```

## 应用层

```markdown
1. 我们应用层 通过应用层协议 把数据传送给 传输层(tcp协议) 然后 传输层 在传给 下三层(网络层 数据链路层 物理层) 最后 把消息 发送给对方 对方接收我们的消息 也是 从下三层协议 然后向上传送
2. 这里 应用层要把各式各样的数据 如字母 数字 汉字 图片等 转换为二进制
在TCP 传输层中 上层的数据被分割成小的数据段 并为每个分段后的数据 封装 TCP报文头部 
在TCP 头部有一个关键的字段信息端口号 它用于标识上层的协议或应用程序 确保上层数据正常通信
在网络层 上层数据被封装 报文头部(IP头部) 上层数据是包括 tcp头部的 ip地址包括的最关键字段嘻嘻信息就是 ip地址 用于 标识网络的逻辑地址 
数据链路层 上层数据成了一个mac头部 内部有最关键的 mac地址 
在物理层 无论之前那一层封装的报文头还是上层数据 都是由二进制组成的 物理将这些二进制数据比特流转换成电信号在网络中传输
```

### 应用层常用协议

```mariadb
1. http 超文本传输协议
2. ftp 文件传输协议
3. smtp 和 pop3 发送文件 和 接受邮件协议
```

```markdown
应用层     < ------  数据  (二进制)     
⬇
传输层     < ------ TCP头部  数据    (包装tcp头部 到下一层变成数据段)
⬇ 
网络层     < ------ IP头部 数据段    (包装IP头部 到下一层变成数据包)
⬇ 
数据链路层  < ------ MAC头部 数据包 尾部   (包装MAC头部 和 尾部 到下一层变成 电流信号)
⬇
物理层     < ------ 光电信号 或者比特流 通过网线传递

```

## HTTP 和 TCP

```markdown
1. 首先明确一个概念 HTTP 是应用层协议 当我们在浏览器发送一个http 请求的时候 首先要经过DNS 服务器 把我们的域名地址变成IP
2. 然后 然后到了下层 就是TCP处理 把我们的 HTTP的请求报文 请求头 之类的 分段切割处理  
3. 然后 由IP 在去 寻址 通过路由中转 去寻址 最后 传输到目标服务
4. 这里我们需要注意一下 我们客户端 和 目标服务器 都是先建立TCP链接的 经过三次握手 四次挥手之类的 
```

## URI和URL

```markdown
1. URI 统一资源标识符 在某个规则下能把这个资源独一无二的标示出来 比如人的身份证号
不用根据上下文来识别资源指定的访问方式 可以标示任何东西 表示可标识的对象
2. URL 同一资源定位符 表示资源的地点 URL时使用浏览器访问WEB页面时需要输入网页地址
```

## 编码

```markdown
1. HTTP可以在传输的过程中 通过编码 提升传输效率 但是会消耗更多的CPU时间
```

### 编码压缩

```markdown
1. 发送文件时可以先用ZIP压缩功能后 在发送文件
2. 编码压缩规范 由 gzip compress deflate identify
```

### 分割发送的分块传输编码

```markdown
1. 请求的实体在尚未传输完成前浏览器不能显示 所以在传输大容量数据时 通过把数据分割成多块 能让浏览器逐步显示页面 
2. 每一块 都成为一个chunk
```

### 多部份对象集合

```markdown
1. 一个报文主体中可以包含多类型实体 
2. 使用boundary字符串来划分多部分对象 指明的各类实体 
```

## Web服务器

### 代理

```markdown
1. 代理就是 客户端 和服务器的中间人
2. 代理可以利用缓存技术减少网络流量 组织内部针对网站进行访问控制 获取访问日志
3. 代理分为 缓存代理 会预先 把资源副本保存在服务器上 透明代理 不对报文进行任何加工
```

### 网关

```markdown
1. 接收从客户端发送来的数据时 会转发给其他服务器处理 在由自己返回
2. 使通信线路上的服务器提供 非 HTTP协议服务 提供通信安全性
```

### 网关和代理的区别

```markdown
代理就是 以知道目标服务器 然后找了一个中间人 去帮你转发
而网关是 你想要一个 服务器上的资源 但是你不知道资源在服务器上的哪里 你就去找网关 网关帮你把所有的资源 和你需要的东西 都整合起来
网关 的概念 跟反向代理差不多
```

## 缓存

```markdown
1. 缓存有对比缓存 和强缓存
```

### 对比缓存

```markdown
1. 服务器 第一次响应的时候 会读取文件最后的修改事件 并且在 响应头里 设置 Last-Modified 字段 响应给浏览器
2. 客户端第二次请求浏览器的时候 会在请求头带着个一个字段 叫 if-modified-since 这个就是 我们刚在响应的狮虎发给浏览器的文件最后请改的时间
3. 然后 服务器 会做对比(代码逻辑) 如果相等 就说明你请求的东西是一样的 然后 跳转304 对比缓存
```

### 对比缓存缺点

```markdown
1. 时间只能精确到秒 如果文件更改时间 是毫秒级别的  就会存在 条件不生效
2. 我们还有好多请求 是要走中间的代理 代理去帮我们拿文件到代理服务器 这样就会存在时间不同的情况 但是请求的东西是一样的就会出现不缓存的情况
```

## E Tag

```markdown
1. 也是对比缓存的一种情况
2. 这里是针对与内容去做缓存的
3. 每次服务器响应的内容 会做一次摘要的加密 然后 设置在 响应头的 Etag字段里 客户端在下次请求相同的内容的时候 会在 头里带着 if-none-match 这个字段 服务器取出来之后 就是我们上次内容的摘要 然后做对比 一致就跳304
```

## 强缓存

```markdown
1. 服务器在响应的时候 在头里 设置 Cache-Control 值是 时间 比如 max-age=10 意思就是 如果你在十秒内请求相同的内容 就不发请求了 去缓存里读取
Cache-Control private 客户端可以缓存
Cache-Control public 客户端和代理服务器可以缓存
Cache-Control max-age=60 缓存在60秒后失效
Cache-Control no-cache 需要使用对比缓存验证数据 强制向资源服务器再次验证
Cache-Control no-store 所有内容都不会缓存 强制缓存和对比缓存都不会触发
```







